# express使用教程

[TOC]

## 一. express简单介绍

### 1.1 介绍

> Express 是一个基于 Node.js 封装的上层服务框架，它提供了更简洁的 API 更实用的新功能。它通过中间件和路由让程序的组织管理变的更加容易；它提供了丰富的 HTTP 工具；它让动态视图的渲染变的更加容易；它还定义了一组可拓展标准。

### 1.2 安装

~~~shell
npm install express -S
~~~

### 1.3 hello world

~~~js
let express = require('express')
let app = express()

app.get('/',(req,res) => res.end('hello world'))

app.listen(3000,() => console.log('Server is running...'))
~~~

**运行示例**

![](./imgs/express-helloworld.gif)



## 二. express中的静态服务

> 在web网站后端开发的过程中，我们往往需要**把一些静态文件夹暴露出去，用户可以根据url地址去访问到其中的内容**，这些静态文件往往也称之为**公共资源**，利用express框架可以方便地托管静态文件。

### 2.1 托管静态文件

1. 在项目目录新建 `public` 静态资源的文件夹

2. 托管静态文件：托管静态文件的方法有三种

### 2.2 托管方法

**方法一**（<font color='red'>推荐</font>）

~~~js
app.use('/public/',express.static('./public'))
~~~

为 `app.use()` 方法传递两个参数，第一个参数为访问的URL前缀，第二个为要托管的目录即要暴露的文件目录

~~~js
let express = require('express');
let app = express()

//设置静态资源
// 方法一
app.use('/public/',express.static('./public'))

app.listen(3000,() => console.log('Server is running...'))
~~~

**示例**

![](./imgs/express-static-method1.jpg)

**方法二**

~~~js
app.use(express.static('./public'))
~~~

方法二在方法一的基础上，省略第一个参数，直接指定暴露的静态资源文件夹

~~~js
let express = require('express');
let app = express()

//设置静态资源
// 方法二
app.use(express.static('./public'))

app.listen(3000,() => console.log('Server is running...'))
~~~

**示例**

![](./imgs/express-static-method2.jpg)

**方法三**

~~~js
app.use('/static/',express.static('./public'))
~~~

同方法一传参类似，只不过将第一个参数设置为你想访问的URL前缀，即指定前缀的别名

~~~js
let express = require('express');
let app = express()

//设置静态资源
// 方法三
app.use('/static/',express.static('./public'))

app.listen(3000,() => console.log('Server is running...'))
~~~

**示例**

![](./imgs/express-static-method3.jpg)



## 三. express中获取post请求数据

> 在post请求中，请求的参数包含在 请求的body中，我们要获取post请求的数据，即是要获取request.body里面的数据
>
>  但是，在默认情况下，我们使用 req.body获取到的内容为undefine，这里需要使用一个中间件`body-parser`来解析传入的请求主体，使req.body可以被访问

**1. 安装 body-parser**

~~~shell
npm install body-parser express -S
~~~

**2. 创建server.js**

~~~js
// server.js

//引入模块
const express = require('express')
const bodyParse = require('body-parser')
// 创建服务器对象
const app = express()

/**
* 通过 body-parser中间件解析req.body
* 根据不同的 Content-Type分别有如下两种不同的配置
* post请求体中的Content—Type为：application/x-www-form-urlencoded，使用配置1
* post请求体中的Content-Type为：application/json，使用配置2
*/
app.use(bodyParse.urlencoded({extended:false}))
app.use(bodyParse.json())

//配置访问路由，返回post请求中的name参数
app.post('/post',(req,res)=>{
    const result = req.body
    console.log(result)
    res.end(result.name)
})

app.listen(3000,()=>console.log('Server is running on localhost:3000'))
~~~

**3. 开启服务器，可通过postman访问URL，自行配置body里面的参数信息，以及指定Content-Type**

![](./imgs/express-post.jpg)

**4. 最后点击左下角的body，即可查看我们服务器中的返回信息**



## 四. express中 art-template的使用

> 前面我们学习了如何在Nodejs中使用`art-template`，在express同样可以使用，接下来我们就来看看，如何在express中使用`art-template`

**1. 在express中使用art-template，首先要安装如下两个模块**

~~~shell
npm install art-template express-art-template -S
~~~

**2. 添加模版界面**

~~~html
// index.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{ title }}</title>
</head>
<body>
    <h1>{{ title }}</h1>
    <p>My name is {{ name }}</p>
    <p>I come from {{ from }}</p>
    <p>I like {{each hobbies}} {{ $value }} {{ /each }}</p>
</body>
</html>
~~~

**3. 添加server.js文件**

~~~js
const express = require('express')
const app = express()


// 配置 express-art-template模版引擎，
//配置之后，服务器请求事件的回调函数的响应对象上会增加一个 render方法，用于渲染模版字符串返回渲染之后的结果
//  第一个参数 html 为模版文件拓展名，表示模版文件必须是HTML文件
app.engine('html',require('express-art-template'))

app.get('/',(req,res)=>{
    res.render('./index.html',{
        title: '个人介绍',
        name: 'Kobe',
        form: 'America',
        bobbies: ['basketball','swimming']
    })
})

app.listen(8000,()=>console.log('Server is running on localhost:3000'))
~~~

**4. 启动服务器，调用URL，我们发现，报如下错误**

~~~shell
Error: Failed to lookup view "./index.html" in views directory "C:\Users\admin\Desktop\work\ForStudy\8.Node.js\DemoFolder\express-art-template-demo\views"
~~~

**<font color=red>错误分析</font>**

- 调用res.render方法的时候，默认会去同级目录的 views文件夹下面去找对应的文件
- 在这里由于我们的server.js和index.html在同级目录下，于是系统找不到views目录下的index.html文件，所以报错
- **规范：**我们一般将模版文件放在与server.js同级的views文件夹下面，方便调用
-  **自定义：**我们还可以通过如下方法，自定义我们希望查找模版界面的目录

~~~js
app.set('views', '替换的文件路径') // 第一个参数必须为：views
~~~



## 五. express中路由模块的提取

> 路由分为前端路由和后端路由，这里我们主要谈论的事后端路由，即URL地址

### 5.1 路由的概念

 **后端路由**

> 对于普通网站，所有的链接都是URL地址，URL地址即对应服务器上面的资源

**前端路由**

> 前端路由主要通过hash（#）来实现，通过hash值的改变来切换界面，同同时，hash值的改变并不会带来http请求的重新响应，使得加载页面的性能更好

### 5.2 路由的提取

> 通过前面的学习我们知道，可以通过express的get和post方法，对不同的URL地址做出响应，最终将结果返回給客户端
>
> **问题描述：**一旦我们的项目界面多了起来，需要处理的请求路径就会比较多，如果全部写在一个文件，就会使得文件难以维护，于是我们可以提取路由文件，专门用来配置路由，最后把路由对象导出挂载到服务器上即可

**实现：**

1. 使用 npm init -y 初始化，并且安装 express 模块

   ~~~shell
   npm init -y
   npm install express -S
   ~~~

2.  创建server.js文件

   ~~~js
   // server.js
   
   const express = require('express')
   const server = express()
   
   server.listen(3000,()=>{
       console.log('Server is running on localhost:3000')
   })
   ~~~

3. 路由文件

   ~~~js
   // router.js
   
   // 引入express并且获取路由对象
   const app = require('express')
   const router = app.Router()
   
   // 配置路由对象
   router.get('/',(req,res)=>{
       res.send('主页')
   })
   
   router.get('/login',(req,res)=>{
       res.send('登陆')
   })
   
   router.get('/register',(req,res)=>{
       res.send('注册')
   })
   
   // 导出路由对象
   module.exports = router
   ~~~

4. 在server.js文件中挂载路由对象

   ~~~js
   // server.js
   
   const express = require('express')
   const server = express()
   //挂载路由对象
   const router = require('./router')
   server.use(router)
   
   server.listen(3000,()=>{
       console.log('Server is running on localhost:3000')
   })
   ~~~

5. 演示

![](./imgs/express-split-router-demo.gif)